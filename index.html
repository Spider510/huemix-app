<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>HÃœMIX Einsatz</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f8f4;
  padding: 20px;
}
h1 { color: #2e7d32; }
label { display:block; margin-top:10px; }
input, select {
  width:100%;
  padding:8px;
  margin-top:4px;
}
button {
  width:100%;
  padding:12px;
  margin-top:10px;
  font-size:16px;
  border:none;
  cursor:pointer;
}
.save { background:#2e7d32; color:#fff; }
.new { background:#1976d2; color:#fff; }
.csv { background:#455a64; color:#fff; }
.del { background:#c62828; color:#fff; }

pre {
  background:#fff;
  padding:10px;
  margin-top:15px;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<h1>ðŸŒ± HÃœMIX Einsatz</h1>

<label>Name<input id="name"></label>
<label>Telefon<input id="telefon"></label>
<label>StraÃŸe<input id="strasse"></label>
<label>Hausnummer<input id="hausnr"></label>
<label>PLZ<input id="plz"></label>
<label>Ort<input id="ort"></label>

<label>HÃœMIX Rasen Spezial â€“ SÃ¤cke (45 â‚¬)
<input id="rasen" type="number" value="0"></label>

<label>HÃœMIX Bio-VolldÃ¼nger â€“ SÃ¤cke (30 â‚¬)
<input id="bio" type="number" value="0"></label>

<label>Ausgestreut
<select id="ausgestreut">
  <option>Ja</option>
  <option>Nein</option>
</select></label>

<label>Zahlungsart
<select id="zahlung">
  <option>Bar</option>
  <option>EC</option>
  <option>Rechnung</option>
</select></label>

<button class="save" onclick="speichern()">ðŸ’¾ Speichern</button>
<button class="new" onclick="neu()">âž• Neuer Eintrag</button>
<button class="csv" onclick="exportCSV()">ðŸ“„ Tages-CSV exportieren</button>
<button class="del" onclick="allesLoeschen()">ðŸ—‘ Alle Daten lÃ¶schen</button>

<pre id="status">GPS wird ermitteltâ€¦</pre>

<script>
const PREIS_RASEN = 45;
const PREIS_BIO = 30;
let lat="", lon="";

/* GPS nur anzeigen */
navigator.geolocation.getCurrentPosition(
  pos => {
    lat = pos.coords.latitude.toFixed(6);
    lon = pos.coords.longitude.toFixed(6);
    status.textContent = "GPS OK: " + lat + ", " + lon;
  },
  () => status.textContent = "GPS nicht verfÃ¼gbar"
);

/* SPEICHERN */
function speichern() {
  const jetzt = new Date();
  const datum =
    jetzt.toLocaleDateString("de-DE") + ", " +
    jetzt.toLocaleTimeString("de-DE", {hour:"2-digit", minute:"2-digit"});

  const rasen = Number(rasenEl.value || 0);
  const bio = Number(bioEl.value || 0);
  const summe = rasen * PREIS_RASEN + bio * PREIS_BIO;

  const eintrag = {
    datum,
    name: name.value,
    telefon: telefon.value,
    strasse: strasse.value,
    hausnr: hausnr.value,
    plz: plz.value,
    ort: ort.value,
    rasen,
    bio,
    ausgestreut: ausgestreut.value,
    zahlung: zahlung.value,
    summe
  };

  const daten = JSON.parse(localStorage.getItem("huemix")) || [];
  daten.push(eintrag);
  localStorage.setItem("huemix", JSON.stringify(daten));

  status.textContent = "Gespeichert: " + datum + " | Summe: " + summe + " â‚¬";
}

/* NEUER EINTRAG */
function neu() {
  document.querySelectorAll("input").forEach(i => i.value = "");
  rasenEl.value = 0;
  bioEl.value = 0;
}

/* CSV EXPORT + TAGESZUSAMMENFASSUNG */
function exportCSV() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];
  if (!daten.length) return alert("Keine Daten");

  let csv = "Datum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut;Zahlung;Summe\n";

  let sum = { Bar:0, EC:0, Rechnung:0 };
  let sack = { Bar:0, EC:0, Rechnung:0 };

  daten.forEach(d => {
    csv += [
      d.datum,d.name,d.telefon,d.strasse,d.hausnr,
      d.plz,d.ort,d.rasen,d.bio,
      d.ausgestreut,d.zahlung,d.summe
    ].join(";") + "\n";

    sum[d.zahlung] += d.summe;
    sack[d.zahlung] += d.rasen + d.bio;
  });

  csv += "\nZUSAMMENFASSUNG\n";
  csv += "Zahlung;SÃ¤cke;Summe\n";
  ["Bar","EC","Rechnung"].forEach(z=>{
    csv += `${z};${sack[z]};${sum[z]}\n`;
  });

  const blob = new Blob(["\uFEFF"+csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "huemix_" + new Date().toISOString().slice(0,10) + ".csv";
  a.click();
}

/* ALLES LÃ–SCHEN */
function allesLoeschen() {
  if (confirm("Wirklich alle Daten lÃ¶schen?")) {
    localStorage.removeItem("huemix");
    status.textContent = "Alle Daten gelÃ¶scht";
  }
}

/* Shortcuts */
const name = document.getElementById("name");
const telefon = document.getElementById("telefon");
const strasse = document.getElementById("strasse");
const hausnr = document.getElementById("hausnr");
const plz = document.getElementById("plz");
const ort = document.getElementById("ort");
const rasenEl = document.getElementById("rasen");
const bioEl = document.getElementById("bio");
const ausgestreut = document.getElementById("ausgestreut");
const zahlung = document.getElementById("zahlung");
const status = document.getElementById("status");
</script>

</body>
</html>