<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>HÃœMIX Einsatz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  background:#f3f7f2;
  margin:0;
  padding:20px;
}
h1 { color:#2e7d32; }
label { font-weight:bold; display:block; margin-top:12px; }
input, select, textarea {
  width:100%;
  padding:10px;
  margin-top:4px;
  font-size:16px;
}
button {
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:16px;
  border:none;
  color:white;
  cursor:pointer;
}
.btn-save { background:#2e7d32; }
.btn-new { background:#1976d2; }
.btn-csv { background:#455a64; }
.btn-del { background:#c62828; }
pre {
  background:white;
  padding:10px;
  white-space:pre-wrap;
}
</style>
</head>

<body>

<h1>ðŸŒ± HÃœMIX Einsatz</h1>

<label>Name</label>
<input id="name">

<label>Telefon</label>
<input id="telefon">

<label>StraÃŸe</label>
<input id="strasse">

<label>Hausnummer</label>
<input id="hausnr">

<label>PLZ</label>
<input id="plz">

<label>Ort</label>
<input id="ort">

<label>HÃœMIX Rasen Spezial â€“ SÃ¤cke (45 â‚¬)</label>
<input id="rasen" type="number" value="0">

<label>HÃœMIX Bio-VolldÃ¼nger â€“ SÃ¤cke (30 â‚¬)</label>
<input id="bio" type="number" value="0">

<label>Ausgestreut</label>
<select id="ausgestreut">
  <option>Ja</option>
  <option>Nein</option>
</select>

<label>Zahlungsart</label>
<select id="zahlung">
  <option>Bar</option>
  <option>EC</option>
  <option>Rechnung</option>
</select>

<button class="btn-save" onclick="speichern()">ðŸ’¾ Speichern</button>
<button class="btn-new" onclick="neu()">âž• Neuer Eintrag</button>
<button class="btn-csv" onclick="exportCSV()">ðŸ“„ Tages-CSV</button>
<button class="btn-csv" onclick="exportSummaryCSV()">ðŸ“Š Tages-Zusammenfassung CSV</button>
<button class="btn-del" onclick="allesLoeschen()">ðŸ—‘ Alle Daten lÃ¶schen</button>

<pre id="ausgabe">GPS wird ermitteltâ€¦</pre>
<textarea id="csvbox" style="display:none"></textarea>

<script>
const PREIS_RASEN = 45;
const PREIS_BIO   = 30;

let lat="", lon="";

navigator.geolocation.getCurrentPosition(
  pos => {
    lat = pos.coords.latitude.toFixed(6);
    lon = pos.coords.longitude.toFixed(6);
    ausgabe.textContent = `GPS OK:\n${lat}, ${lon}`;
  },
  () => ausgabe.textContent = "GPS nicht verfÃ¼gbar"
);

function heuteKey() {
  return new Date().toISOString().slice(0,10);
}

function speichern() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];

  const rasen = Number(document.getElementById("rasen").value || 0);
  const bio   = Number(document.getElementById("bio").value || 0);
  const gesamt = rasen*PREIS_RASEN + bio*PREIS_BIO;

  daten.push({
    isoDate: heuteKey(),
    datum: new Date().toLocaleString("de-DE"),
    name: name.value,
    telefon: telefon.value,
    strasse: strasse.value,
    hausnr: hausnr.value,
    plz: plz.value,
    ort: ort.value,
    rasen,
    bio,
    ausgestreut: ausgestreut.value,
    zahlung: zahlung.value,
    gesamt
  });

  localStorage.setItem("huemix", JSON.stringify(daten));

  ausgabe.textContent =
`ðŸŒ± HÃœMIX Einsatz gespeichert
Name: ${name.value}
Ort: ${plz.value} ${ort.value}
Rasen: ${rasen} | Bio: ${bio}
Zahlung: ${zahlung.value}
Summe: ${gesamt} â‚¬`;
}

function neu() {
  document.querySelectorAll("input").forEach(i=>i.value="");
  rasen.value=0; bio.value=0;
}

function allesLoeschen() {
  if(confirm("Wirklich ALLE Daten lÃ¶schen?")) {
    localStorage.removeItem("huemix");
    ausgabe.textContent="Alle Daten gelÃ¶scht";
  }
}

function exportCSV() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];
  const heute = daten.filter(e=>e.isoDate===heuteKey());
  if(!heute.length) return alert("Keine Daten");

  let csv="\uFEFFDatum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut;Zahlung;Summe\n";
  heute.forEach(e=>{
    csv+=`${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.ausgestreut};${e.zahlung};${e.gesamt}\n`;
  });
  download(csv,"huemix_tag.csv");
}

function exportSummaryCSV() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];
  const heute = daten.filter(e=>e.isoDate===heuteKey());

  const sum = {Bar:[0,0,0],EC:[0,0,0],Rechnung:[0,0,0]};
  heute.forEach(e=>{
    sum[e.zahlung][0]+=e.rasen;
    sum[e.zahlung][1]+=e.bio;
    sum[e.zahlung][2]+=e.gesamt;
  });

  let csv="\uFEFFZahlung;Rasen;Bio;Summe\n";
  Object.keys(sum).forEach(z=>{
    csv+=`${z};${sum[z][0]};${sum[z][1]};${sum[z][2]}\n`;
  });

  download(csv,"huemix_zusammenfassung.csv");
}

function download(text, name) {
  const blob=new Blob([text],{type:"text/csv;charset=utf-8;"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}
</script>

</body>
</html>