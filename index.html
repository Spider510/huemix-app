<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>H√úMIX Einsatz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f4f7f4; padding:20px; }
h1 { color:#2e7d32; }
label { font-weight:bold; display:block; margin-top:12px; }
input, select, button {
  width:100%; padding:10px; margin-top:4px;
  border-radius:6px; border:1px solid #ccc;
}
button { font-size:16px; margin-top:10px; cursor:pointer; }
.green { background:#2e7d32; color:white; }
.blue { background:#1976d2; color:white; }
.gray { background:#455a64; color:white; }
.purple { background:#6a1b9a; color:white; }
.red { background:#c62828; color:white; }
.box { background:white; padding:15px; border-radius:8px; margin-bottom:20px; }
pre { white-space:pre-wrap; }
.status { margin-top:10px; font-style:italic; }
</style>
</head>

<body>

<h1>üå± H√úMIX Einsatz</h1>

<div class="box">
<label>Name</label><input id="name">
<label>Telefon</label><input id="telefon">

<label>Stra√üe</label><input id="strasse">
<label>Hausnummer</label><input id="hausnr">
<label>PLZ</label><input id="plz">
<label>Ort</label><input id="ort">

<label>Rasen Spezial ‚Äì S√§cke (45 ‚Ç¨)</label>
<input id="rasen" type="number" min="0" value="0">

<label>Bio-Volld√ºnger ‚Äì S√§cke (30 ‚Ç¨)</label>
<input id="bio" type="number" min="0" value="0">

<label>Ausgestreut</label>
<select id="ausgestreut">
  <option>Ja</option>
  <option>Nein</option>
</select>

<label>Zahlungsart</label>
<select id="zahlung">
  <option>Bar</option>
  <option>EC</option>
</select>

<button class="blue" onclick="gpsHolen()">üìç GPS neu holen</button>
<div id="gpsinfo" class="status">GPS noch nicht ermittelt</div>

<button class="green" onclick="speichern()">üíæ Speichern</button>
</div>

<div class="box">
<button class="blue" onclick="neu()">‚ûï Neuer Eintrag</button>
<button class="gray" onclick="csvExport()">üìÑ Tages-CSV</button>
<button class="purple" onclick="tagesSumme()">üìä Tageszusammenfassung</button>
<button class="red" onclick="allesLoeschen()">üóëÔ∏è Alle Daten l√∂schen</button>
</div>

<div class="box">
<pre id="ausgabe">Bereit.</pre>
</div>

<script>
let lat=null, lon=null;

function gpsHolen() {
  document.getElementById("gpsinfo").textContent="GPS wird ermittelt‚Ä¶";
  navigator.geolocation.getCurrentPosition(
    pos=>{
      lat=pos.coords.latitude;
      lon=pos.coords.longitude;
      document.getElementById("gpsinfo").textContent =
        "GPS OK: "+lat.toFixed(6)+", "+lon.toFixed(6);
      adresseAusGPS();
    },
    err=>{
      document.getElementById("gpsinfo").textContent="GPS Fehler";
      alert("GPS Fehler: "+err.message);
    },
    { enableHighAccuracy:true, timeout:10000 }
  );
}

function adresseAusGPS() {
  fetch(`https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${lat}&lon=${lon}`)
    .then(r=>r.json())
    .then(d=>{
      if(!d.address) return;
      strasse.value=d.address.road||"";
      hausnr.value=d.address.house_number||"";
      plz.value=d.address.postcode||"";
      ort.value=d.address.city||d.address.town||d.address.village||"";
    });
}

function speichern() {
  const now=new Date();
  const datum=now.toLocaleDateString("de-DE")+" "+
    now.toLocaleTimeString("de-DE",{hour:'2-digit',minute:'2-digit'});

  const r=+rasen.value||0;
  const b=+bio.value||0;
  const sum=r*45+b*30;

  const eintrag={
    datum,
    name:name.value||"",
    telefon:telefon.value||"",
    strasse:strasse.value||"",
    hausnr:hausnr.value||"",
    plz:plz.value||"",
    ort:ort.value||"",
    rasen:r,
    bio:b,
    ausgestreut:ausgestreut.value,
    zahlung:zahlung.value,
    summe:sum
  };

  const daten=JSON.parse(localStorage.getItem("huemix")||"[]");
  daten.push(eintrag);
  localStorage.setItem("huemix",JSON.stringify(daten));

  ausgabe.textContent="Gespeichert:\n"+JSON.stringify(eintrag,null,2);
}

function neu(){
  document.querySelectorAll("input").forEach(i=>i.value="");
  rasen.value=0; bio.value=0;
  gpsinfo.textContent="GPS noch nicht ermittelt";
  lat=null; lon=null;
}

function csvExport(){
  const d=JSON.parse(localStorage.getItem("huemix")||"[]");
  let csv="Datum;Name;Telefon;Stra√üe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut;Zahlung;Summe\n";
  d.forEach(e=>{
    csv+=`${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.ausgestreut};${e.zahlung};${e.summe}\n`;
  });
  download(csv,"huemix_tag.csv");
}

function tagesSumme(){
  const d=JSON.parse(localStorage.getItem("huemix")||"[]");
  let bar={r:0,b:0,s:0}, ec={r:0,b:0,s:0};

  d.forEach(e=>{
    if(e.zahlung==="Bar"){ bar.r+=e.rasen; bar.b+=e.bio; bar.s+=e.summe; }
    if(e.zahlung==="EC"){ ec.r+=e.rasen; ec.b+=e.bio; ec.s+=e.summe; }
  });

  ausgabe.textContent=
`TAGESZUSAMMENFASSUNG

BAR
Rasen: ${bar.r}
Bio: ${bar.b}
Summe: ${bar.s} ‚Ç¨

EC
Rasen: ${ec.r}
Bio: ${ec.b}
Summe: ${ec.s} ‚Ç¨`;
}

function allesLoeschen(){
  if(confirm("Wirklich ALLE Daten l√∂schen?")){
    localStorage.removeItem("huemix");
    ausgabe.textContent="Alle Daten gel√∂scht.";
  }
}

function download(txt,name){
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([txt],{type:"text/csv;charset=utf-8;"}));
  a.download=name;
  a.click();
}

const name=document.getElementById("name");
const telefon=document.getElementById("telefon");
const strasse=document.getElementById("strasse");
const hausnr=document.getElementById("hausnr");
const plz=document.getElementById("plz");
const ort=document.getElementById("ort");
const rasen=document.getElementById("rasen");
const bio=document.getElementById("bio");
const ausgestreut=document.getElementById("ausgestreut");
const zahlung=document.getElementById("zahlung");
const gpsinfo=document.getElementById("gpsinfo");
const ausgabe=document.getElementById("ausgabe");
</script>

</body>
</html>