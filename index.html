<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>HÃœMIX Einsatz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background:#f4f6f4; padding:15px; }
h1 { color:#2e7d32; }
label { display:block; margin-top:10px; }
input, select, button { width:100%; padding:8px; margin-top:4px; }
button { background:#2e7d32; color:white; border:none; font-size:16px; margin-top:15px; }
pre { background:white; padding:10px; margin-top:15px; white-space:pre-wrap; }
</style>
</head>

<body>

<h1>ðŸŒ± HÃœMIX Einsatz</h1>

<label>Name<input id="name"></label>
<label>Telefon<input id="telefon"></label>
<label>StraÃŸe<input id="strasse"></label>
<label>Hausnummer<input id="hausnummer"></label>
<label>Ort<input id="ort"></label>

<label>HÃœMIX Rasen Spezial â€“ SÃ¤cke<input id="rasen" type="number" value="0"></label>
<label>HÃœMIX Bio-VolldÃ¼nger â€“ SÃ¤cke<input id="bio" type="number" value="0"></label>

<label>Ausgestreut
<select id="ausgestreut">
<option>Ja</option>
<option>Nein</option>
</select>
</label>

<button onclick="speichern()">Speichern</button>
<button onclick="exportCSV()">ðŸ“¤ Tages-CSV exportieren</button>

<pre id="ausgabe">GPS wird ermitteltâ€¦</pre>

<script>
let lat="", lon="";

navigator.geolocation.getCurrentPosition(
  pos => {
    lat = pos.coords.latitude.toFixed(6);
    lon = pos.coords.longitude.toFixed(6);
    ausgabe.textContent = "GPS OK: " + lat + ", " + lon;
    adresseLaden();
  },
  () => ausgabe.textContent = "GPS nicht verfÃ¼gbar",
  { enableHighAccuracy:true }
);

function adresseLaden() {
  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
    .then(r => r.json())
    .then(d => {
      if (!d.address) return;
      strasse.value = d.address.road || "";
      hausnummer.value = d.address.house_number || "";
      ort.value = d.address.city || d.address.town || d.address.village || "";
    });
}

function speichern() {
  const jetzt = new Date();
  const datum = jetzt.toISOString().slice(0,10);
  const zeit = jetzt.toLocaleTimeString("de-DE");

  const zeile = [
    datum, zeit,
    name.value, telefon.value,
    strasse.value, hausnummer.value, ort.value,
    lat, lon,
    rasen.value, bio.value, ausgestreut.value
  ].join(";");

  const key = "huemix_" + datum;
  const alt = localStorage.getItem(key);
  const neu = alt ? alt + "\n" + zeile :
    "Datum;Zeit;Name;Telefon;StraÃŸe;Hausnr;Ort;Lat;Lon;Rasen;Bio;Ausgestreut\n" + zeile;

  localStorage.setItem(key, neu);
  ausgabe.textContent = "Gespeichert:\n" + zeile;
}

function exportCSV() {
  const datum = new Date().toISOString().slice(0,10);
  const daten = localStorage.getItem("huemix_" + datum);
  if (!daten) return alert("Keine Daten fÃ¼r heute");

  const blob = new Blob([daten], { type:"text/csv;charset=utf-8;" });
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "huemix-" + datum + ".csv";
  a.click();
}
</script>

</body>
</html>