<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>HÃœMIX Einsatz</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f7f4; padding:20px; }
h1 { color:#2e7d32; }
label { display:block; margin-top:12px; }
input, select { width:100%; padding:8px; margin-top:4px; }
button { margin-top:12px; padding:10px; width:100%; font-size:16px; }
.save { background:#2e7d32; color:white; border:none; }
.new { background:#1976d2; color:white; border:none; }
.delete { background:#c62828; color:white; border:none; }
.csv { background:#455a64; color:white; border:none; }
pre { background:white; padding:10px; margin-top:15px; }
</style>
</head>

<body>

<h1>ğŸŒ± HÃœMIX Einsatz</h1>

<label>Name <input id="name"></label>
<label>Telefon <input id="telefon"></label>
<label>StraÃŸe <input id="strasse"></label>
<label>Hausnummer <input id="hausnummer"></label>
<label>PLZ <input id="plz"></label>
<label>Ort <input id="ort"></label>

<label>HÃœMIX Rasen Spezial â€“ SÃ¤cke
<input id="rasen" type="number" value="0"></label>

<label>HÃœMIX Bio-VolldÃ¼nger â€“ SÃ¤cke
<input id="bio" type="number" value="0"></label>

<label>Ausgestreut
<select id="ausgestreut">
<option>Ja</option>
<option>Nein</option>
</select></label>

<button class="save" onclick="speichern()">ğŸ’¾ Speichern</button>
<button class="new" onclick="neuerEintrag()">â• Neuer Eintrag</button>
<button class="csv" onclick="csvExport()">ğŸ“„ Tages-CSV exportieren</button>
<button class="delete" onclick="alleLoeschen()">ğŸ—‘ï¸ Alle Daten lÃ¶schen</button>

<pre id="ausgabe">GPS wird ermitteltâ€¦</pre>

<script>
let lat="", lon="";

navigator.geolocation.getCurrentPosition(async pos=>{
  lat = pos.coords.latitude;
  lon = pos.coords.longitude;
  ausgabe.textContent = "GPS OK: "+lat.toFixed(6)+", "+lon.toFixed(6);

  // Adresse holen
  const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=de`;
  const res = await fetch(url);
  const data = await res.json();
  const a = data.address || {};

  strasse.value = a.road || "";
  hausnummer.value = a.house_number || "";
  plz.value = a.postcode || "";
  ort.value = a.city || a.town || a.village || "";

}, err=>{
  ausgabe.textContent = "GPS-Fehler: "+err.message;
},{enableHighAccuracy:true});

function speichern(){
  const eintrag = {
    datum: new Date().toLocaleString("de-DE"),
    name: name.value,
    telefon: telefon.value,
    strasse: strasse.value,
    hausnr: hausnummer.value,
    plz: plz.value,
    ort: ort.value,
    rasen: rasen.value,
    bio: bio.value,
    ausgestreut: ausgestreut.value
  };

  let liste = JSON.parse(localStorage.getItem("huemix")) || [];
  liste.push(eintrag);
  localStorage.setItem("huemix", JSON.stringify(liste));

  ausgabe.textContent = "Eintrag gespeichert.";
}

function neuerEintrag(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="number") i.value=0; else i.value="";
  });
  ausgabe.textContent = "Neuer Eintrag bereit.";
}

function alleLoeschen(){
  if(confirm("Wirklich ALLE Daten lÃ¶schen?")){
    localStorage.removeItem("huemix");
    ausgabe.textContent = "Alle Daten gelÃ¶scht.";
  }
}

function csvExport(){
  let liste = JSON.parse(localStorage.getItem("huemix")) || [];
  if(!liste.length){ alert("Keine Daten vorhanden"); return; }

  let csv = "Datum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut\n";
  liste.forEach(e=>{
    csv += `${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.ausgestreut}\n`;
  });

  const blob = new Blob(["\uFEFF"+csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "huemix_"+new Date().toISOString().slice(0,10)+".csv";
  a.click();
}
</script>

</body>
</html>