<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HÃœMIX Einsatz</title>

<style>
body{font-family:Arial;background:#f4f7f4;margin:0}
.container{max-width:900px;margin:auto;padding:15px}
h1{color:#2e7d32}
label{font-weight:bold}
input,select,button{width:100%;padding:10px;margin-bottom:10px;font-size:16px}
button{border:none;color:white;border-radius:4px}
.save{background:#2e7d32}
.new{background:#1976d2}
.csv{background:#455a64}
.sum{background:#6a1b9a}
.del{background:#c62828}
.gps{background:#0288d1}
.status{padding:8px;font-size:14px}
</style>
</head>

<body>
<div class="container">
<h1>ğŸŒ± HÃœMIX Einsatz</h1>

<label>Name</label>
<input id="name">

<label>Telefon</label>
<input id="telefon">

<label>StraÃŸe</label>
<input id="strasse">

<label>Hausnummer</label>
<input id="hausnr">

<label>PLZ</label>
<input id="plz">

<label>Ort</label>
<input id="ort">

<label>Rasen Spezial â€“ SÃ¤cke (45 â‚¬)</label>
<input id="rasen" type="number" value="0">

<label>Bio-VolldÃ¼nger â€“ SÃ¤cke (30 â‚¬)</label>
<input id="bio" type="number" value="0">

<label>Ausgestreut</label>
<select id="ausgestreut">
<option>Ja</option>
<option>Nein</option>
</select>

<label>Zahlungsart</label>
<select id="zahlung">
<option>Bar</option>
<option>EC</option>
</select>

<button class="gps" onclick="gpsHolen()">ğŸ“ GPS neu holen</button>
<div id="gpsinfo" class="status">GPS noch nicht ermittelt</div>

<button class="save" onclick="speichern()">ğŸ’¾ Speichern</button>
<button class="new" onclick="neu()">â• Neuer Eintrag</button>
<button class="csv" onclick="tagesCSV()">ğŸ“„ Tages-CSV</button>
<button class="sum" onclick="tagesSumme()">ğŸ“Š Tageszusammenfassung</button>
<button class="del" onclick="allesLoeschen()">ğŸ—‘ï¸ Alle Daten lÃ¶schen</button>

<div id="status" class="status"></div>
</div>

<script>
let lat=null, lon=null;

function zeitstempel(name){
  const d=new Date();
  return `${name}_${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}_${String(d.getHours()).padStart(2,"0")}${String(d.getMinutes()).padStart(2,"0")}.csv`;
}

function gpsHolen(){
  gpsinfo.textContent="GPS wird ermittelt...";
  lat=lon=null;
  strasse.value=hausnr.value=plz.value=ort.value="";

  navigator.geolocation.getCurrentPosition(pos=>{
    lat=pos.coords.latitude;
    lon=pos.coords.longitude;
    gpsinfo.textContent=`GPS OK: ${lat.toFixed(6)}, ${lon.toFixed(6)}`;
    adresseVonGPS();
  },()=>{
    gpsinfo.textContent="GPS fehlgeschlagen";
  });
}

function adresseVonGPS(){
  fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`)
  .then(r=>r.json())
  .then(d=>{
    strasse.value=d.address.road||"";
    hausnr.value=d.address.house_number||"";
    plz.value=d.address.postcode||"";
    ort.value=d.address.city||d.address.town||d.address.village||"";
  });
}

function speichern(){
  const jetzt=new Date();
  const eintrag={
    datum:jetzt.toLocaleString("de-DE",{hour:"2-digit",minute:"2-digit"}),
    name:name.value,
    telefon:telefon.value,
    strasse:strasse.value,
    hausnr:hausnr.value,
    plz:plz.value,
    ort:ort.value,
    rasen:Number(rasen.value)||0,
    bio:Number(bio.value)||0,
    ausgestreut:ausgestreut.value,
    zahlung:zahlung.value,
    summe:(rasen.value*45)+(bio.value*30)
  };

  const liste=JSON.parse(localStorage.getItem("huemix")||"[]");
  liste.push(eintrag);
  localStorage.setItem("huemix",JSON.stringify(liste));

  status.textContent="Gespeichert âœ”";
  neu();
}

function neu(){
  name.value=telefon.value=strasse.value=hausnr.value=plz.value=ort.value="";
  rasen.value=bio.value=0;
}

function exportCSV(csv,name){
  const blob=new Blob(["\ufeff"+csv],{type:"text/csv;charset=utf-8"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(blob);
  a.download=name;
  a.click();
}

function tagesCSV(){
  const daten=JSON.parse(localStorage.getItem("huemix")||"[]");
  let csv="Datum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut;Zahlung;Summe â‚¬\n";
  daten.forEach(e=>{
    csv+=`${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.ausgestreut};${e.zahlung};${e.summe}\n`;
  });
  exportCSV(csv,zeitstempel("huemix_tagesliste"));
}

function tagesSumme(){
  const daten=JSON.parse(localStorage.getItem("huemix")||"[]");
  let bar={r:0,b:0,s:0}, ec={r:0,b:0,s:0};

  daten.forEach(e=>{
    if(e.zahlung==="Bar"){bar.r+=e.rasen;bar.b+=e.bio;bar.s+=e.summe;}
    if(e.zahlung==="EC"){ec.r+=e.rasen;ec.b+=e.bio;ec.s+=e.summe;}
  });

  const g={r:bar.r+ec.r,b:bar.b+ec.b,s:bar.s+ec.s};
  const datum=new Date().toLocaleDateString("de-DE");

  let csv="Datum;Zahlung;Rasen SÃ¤cke;Bio SÃ¤cke;Summe â‚¬\n";
  csv+=`${datum};Bar;${bar.r};${bar.b};${bar.s}\n`;
  csv+=`${datum};EC;${ec.r};${ec.b};${ec.s}\n`;
  csv+=`${datum};GESAMT;${g.r};${g.b};${g.s}\n`;

  exportCSV(csv,zeitstempel("huemix_tageszusammenfassung"));
}

function allesLoeschen(){
  if(confirm("Wirklich ALLES lÃ¶schen?")){
    localStorage.removeItem("huemix");
    status.textContent="Alle Daten gelÃ¶scht";
  }
}
</script>
</body>
</html>