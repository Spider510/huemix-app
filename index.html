<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>HÃœMIX Einsatz</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f7f4; padding:20px; }
h1 { color:#2e7d32; }
label { display:block; margin-top:12px; }
input, select { width:100%; padding:8px; margin-top:4px; }
button { margin-top:12px; padding:12px; width:100%; font-size:16px; border:none; }
.save { background:#2e7d32; color:white; }
.new { background:#1976d2; color:white; }
.csv { background:#455a64; color:white; }
.delete { background:#c62828; color:white; }
.box { background:white; padding:12px; margin-top:15px; }
</style>
</head>

<body>

<h1>ğŸŒ± HÃœMIX Einsatz</h1>

<label>Name <input id="name"></label>
<label>Telefon <input id="telefon"></label>
<label>StraÃŸe <input id="strasse"></label>
<label>Hausnummer <input id="hausnr"></label>
<label>PLZ <input id="plz"></label>
<label>Ort <input id="ort"></label>

<label>HÃœMIX Rasen Spezial â€“ SÃ¤cke (45 â‚¬)
<input id="rasen" type="number" value="0"></label>

<label>HÃœMIX Bio-VolldÃ¼nger â€“ SÃ¤cke (30 â‚¬)
<input id="bio" type="number" value="0"></label>

<label>Ausgestreut
<select id="ausgestreut">
<option>Ja</option>
<option>Nein</option>
</select></label>

<label>Zahlungsart
<select id="zahlung">
<option>Bar</option>
<option>EC-Karte</option>
<option>Rechnung</option>
</select></label>

<button class="save" onclick="speichern()">ğŸ’¾ Speichern</button>
<button class="new" onclick="neuerEintrag()">â• Neuer Eintrag</button>
<button class="csv" onclick="csvExport()">ğŸ“„ Tages-CSV exportieren</button>
<button class="delete" onclick="alleLoeschen()">ğŸ—‘ï¸ Alle Daten lÃ¶schen</button>

<div class="box" id="status">GPS wird ermitteltâ€¦</div>
<div class="box" id="statistik"></div>

<script>
// Feste Preise
const PREIS_RASEN = 45;
const PREIS_BIO = 30;

// Adresse per GPS
navigator.geolocation.getCurrentPosition(async pos=>{
  const lat = pos.coords.latitude;
  const lon = pos.coords.longitude;

  const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&accept-language=de`;
  const res = await fetch(url);
  const data = await res.json();
  const a = data.address || {};

  strasse.value = a.road || "";
  hausnr.value = a.house_number || "";
  plz.value = a.postcode || "";
  ort.value = a.city || a.town || a.village || "";

  status.textContent = "Adresse automatisch Ã¼bernommen";
},{enableHighAccuracy:true});

function speichern(){
  let liste = JSON.parse(localStorage.getItem("huemix")) || [];

  const rasenAnz = Number(rasen.value);
  const bioAnz = Number(bio.value);

  const preisRasen = rasenAnz * PREIS_RASEN;
  const preisBio = bioAnz * PREIS_BIO;
  const gesamt = preisRasen + preisBio;

  const eintrag = {
    nr: liste.length + 1,
    datum: new Date().toLocaleString("de-DE"),
    name: name.value,
    telefon: telefon.value,
    strasse: strasse.value,
    hausnr: hausnr.value,
    plz: plz.value,
    ort: ort.value,
    rasen: rasenAnz,
    bio: bioAnz,
    preisRasen: preisRasen,
    preisBio: preisBio,
    gesamt: gesamt,
    ausgestreut: ausgestreut.value,
    zahlung: zahlung.value
  };

  liste.push(eintrag);
  localStorage.setItem("huemix", JSON.stringify(liste));

  status.textContent = `Gespeichert â€“ Gesamt: ${gesamt.toFixed(2)} â‚¬`;
  statistikAnzeigen();
}

function neuerEintrag(){
  document.querySelectorAll("input").forEach(i=>{
    if(i.type==="number") i.value=0; else i.value="";
  });
  zahlung.value="Bar";
  status.textContent = "Neuer Eintrag";
}

function alleLoeschen(){
  if(confirm("Wirklich alle Daten lÃ¶schen?")){
    localStorage.removeItem("huemix");
    statistik.textContent="";
    status.textContent="Alle Daten gelÃ¶scht";
  }
}

function statistikAnzeigen(){
  let liste = JSON.parse(localStorage.getItem("huemix")) || [];
  let rasenSum=0, bioSum=0, umsatz=0;

  liste.forEach(e=>{
    rasenSum+=e.preisRasen;
    bioSum+=e.preisBio;
    umsatz+=e.gesamt;
  });

  statistik.innerHTML = `
<b>ğŸ“Š Tagesumsatz</b><br>
Rasen: ${rasenSum.toFixed(2)} â‚¬<br>
Bio: ${bioSum.toFixed(2)} â‚¬<br>
<b>Gesamt: ${umsatz.toFixed(2)} â‚¬</b>
`;
}

function csvExport(){
  let liste = JSON.parse(localStorage.getItem("huemix")) || [];
  if(!liste.length){ alert("Keine Daten"); return; }

  let csv = "Nr;Datum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Preis Rasen â‚¬;Preis Bio â‚¬;Gesamt â‚¬;Ausgestreut;Zahlung\n";

  liste.forEach(e=>{
    csv += `${e.nr};${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.preisRasen.toFixed(2)};${e.preisBio.toFixed(2)};${e.gesamt.toFixed(2)};${e.ausgestreut};${e.zahlung}\n`;
  });

  const blob = new Blob(["\uFEFF"+csv], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "huemix_"+new Date().toISOString().slice(0,10)+".csv";
  a.click();
}

statistikAnzeigen();
</script>

</body>
</html>