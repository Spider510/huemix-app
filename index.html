<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HÃœMIX Einsatz</title>

<style>
body { font-family: Arial, sans-serif; background:#f4f7f4; margin:0; padding:10px; }
h1 { color:#2e7d32; }
label { font-weight:bold; display:block; margin-top:10px; }
input, select, button {
  width:100%; padding:8px; margin-top:4px;
  font-size:16px;
}
button { margin-top:10px; cursor:pointer; border:none; }
.save { background:#2e7d32; color:white; }
.new { background:#1976d2; color:white; }
.csv { background:#455a64; color:white; }
.sum { background:#6a1b9a; color:white; }
.del { background:#c62828; color:white; }
pre { background:white; padding:10px; margin-top:15px; }
</style>
</head>

<body>

<h1>ðŸŒ± HÃœMIX Einsatz</h1>

<label>Name</label>
<input id="name">

<label>Telefon</label>
<input id="telefon">

<label>StraÃŸe</label>
<input id="strasse">

<label>Hausnummer</label>
<input id="hausnr">

<label>PLZ</label>
<input id="plz">

<label>Ort</label>
<input id="ort">

<label>Rasen Spezial â€“ SÃ¤cke (45 â‚¬)</label>
<input id="rasen" type="number" value="0">

<label>Bio-VolldÃ¼nger â€“ SÃ¤cke (30 â‚¬)</label>
<input id="bio" type="number" value="0">

<label>Ausgestreut</label>
<select id="ausgestreut">
  <option>Ja</option>
  <option>Nein</option>
</select>

<label>Zahlungsart</label>
<select id="zahlung">
  <option>Bar</option>
  <option>EC</option>
  <option>Rechnung</option>
</select>

<button class="save" onclick="speichern()">ðŸ’¾ Speichern</button>
<button class="new" onclick="neu()">âž• Neuer Eintrag</button>
<button class="csv" onclick="exportCSV()">ðŸ“„ Tages-CSV</button>
<button class="sum" onclick="exportSummary()">ðŸ“Š Tageszusammenfassung</button>
<button class="del" onclick="allesLoeschen()">ðŸ—‘ Alle Daten lÃ¶schen</button>

<pre id="ausgabe">Bereit.</pre>

<script>
const PREIS_RASEN = 45;
const PREIS_BIO   = 30;

function jetzt() {
  const d = new Date();
  return d.toLocaleDateString("de-DE") + ", " +
         d.toLocaleTimeString("de-DE", {hour:"2-digit", minute:"2-digit"});
}

function speichern() {
  const eintrag = {
    datum: jetzt(),
    name: name.value || "",
    telefon: telefon.value || "",
    strasse: strasse.value || "",
    hausnr: hausnr.value || "",
    plz: plz.value || "",
    ort: ort.value || "",
    rasen: Number(rasen.value) || 0,
    bio: Number(bio.value) || 0,
    ausgestreut: ausgestreut.value,
    zahlung: zahlung.value
  };

  eintrag.summe =
    eintrag.rasen * PREIS_RASEN +
    eintrag.bio * PREIS_BIO;

  const liste = JSON.parse(localStorage.getItem("huemix")) || [];
  liste.push(eintrag);
  localStorage.setItem("huemix", JSON.stringify(liste));

  ausgabe.textContent =
    "Gespeichert:\n" +
    eintrag.datum + "\n" +
    eintrag.strasse + " " + eintrag.hausnr + ", " +
    eintrag.plz + " " + eintrag.ort + "\n" +
    "Summe: " + eintrag.summe + " â‚¬";
}

function neu() {
  document.querySelectorAll("input").forEach(i => {
    if (i.type === "number") i.value = 0;
    else i.value = "";
  });
  ausgabe.textContent = "Neuer Eintrag.";
}

function exportCSV() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];
  let csv = "Datum;Name;Telefon;StraÃŸe;Hausnr;PLZ;Ort;Rasen;Bio;Ausgestreut;Zahlung;Summe\n";

  daten.forEach(e => {
    csv += `${e.datum};${e.name};${e.telefon};${e.strasse};${e.hausnr};${e.plz};${e.ort};${e.rasen};${e.bio};${e.ausgestreut};${e.zahlung};${e.summe}\n`;
  });

  download(csv, "huemix_tagesliste.csv");
}

function exportSummary() {
  const daten = JSON.parse(localStorage.getItem("huemix")) || [];

  let barR=0, barB=0, barS=0;
  let ecR=0, ecB=0, ecS=0;

  daten.forEach(e => {
    const r = Number(e.rasen) || 0;
    const b = Number(e.bio) || 0;
    const s = r * PREIS_RASEN + b * PREIS_BIO;

    if (e.zahlung === "Bar") {
      barR+=r; barB+=b; barS+=s;
    }
    if (e.zahlung === "EC") {
      ecR+=r; ecB+=b; ecS+=s;
    }
  });

  let csv =
    "Zahlung;Rasen SÃ¤cke;Bio SÃ¤cke;Summe â‚¬\n" +
    `Bar;${barR};${barB};${barS}\n` +
    `EC;${ecR};${ecB};${ecS}\n`;

  download(csv, "huemix_tageszusammenfassung.csv");
}

function allesLoeschen() {
  if (confirm("Wirklich alle Daten lÃ¶schen?")) {
    localStorage.removeItem("huemix");
    ausgabe.textContent = "Alle Daten gelÃ¶scht.";
  }
}

function download(text, file) {
  const blob = new Blob(["\uFEFF" + text], {type:"text/csv;charset=utf-8;"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = file;
  a.click();
}
</script>

</body>
</html>