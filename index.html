<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>H√úMIX Einsatz</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: Arial, sans-serif; background:#f4f6f4; padding:15px; }
h1 { color:#2e7d32; }
label { display:block; margin-top:10px; }
input, select, button {
  width:100%; padding:10px; margin-top:5px; font-size:16px;
}
button {
  background:#2e7d32; color:white; border:none; margin-top:15px;
}
pre {
  background:#fff; padding:10px; margin-top:15px; white-space:pre-wrap;
}
</style>
</head>

<body>

<h1>üå± H√úMIX Einsatz</h1>

<label>Name<input id="name"></label>
<label>Telefon<input id="telefon"></label>

<label>Stra√üe<input id="strasse"></label>
<label>Hausnummer<input id="hausnummer"></label>
<label>PLZ<input id="plz"></label>
<label>Ort<input id="ort"></label>

<label>H√úMIX Rasen Spezial ‚Äì S√§cke
<input id="rasen" type="number" value="0"></label>

<label>H√úMIX Bio-Volld√ºnger ‚Äì S√§cke
<input id="bio" type="number" value="0"></label>

<label>Ausgestreut
<select id="ausgestreut">
<option>Ja</option>
<option>Nein</option>
</select>
</label>

<button onclick="speichern()">Speichern</button>
<button onclick="exportCSV()">üìÅ Tages-CSV exportieren</button>

<pre id="ausgabe">GPS wird ermittelt‚Ä¶</pre>

<script>
let lat = "", lon = "";

// GPS + Adresse holen
navigator.geolocation.getCurrentPosition(
  async pos => {
    lat = pos.coords.latitude;
    lon = pos.coords.longitude;

    const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`;
    const res = await fetch(url);
    const data = await res.json();
    const a = data.address || {};

    document.getElementById("strasse").value = a.road || "";
    document.getElementById("hausnummer").value = a.house_number || "";
    document.getElementById("plz").value = a.postcode || "";
    document.getElementById("ort").value =
      a.city || a.town || a.village || "";

    ausgabe.textContent =
      "GPS OK:\n" +
      lat.toFixed(6) + ", " + lon.toFixed(6);
  },
  err => {
    ausgabe.textContent = "GPS Fehler: " + err.message;
  },
  { enableHighAccuracy:true, timeout:10000 }
);

// Speichern
function speichern() {
  const jetzt = new Date().toLocaleString("de-DE");

  const eintrag = [
    jetzt,
    name.value,
    telefon.value,
    strasse.value,
    hausnummer.value,
    plz.value,
    ort.value,
    lat,
    lon,
    rasen.value,
    bio.value,
    ausgestreut.value
  ].join(";");

  let liste = JSON.parse(localStorage.getItem("huemix")) || [];
  liste.push(eintrag);
  localStorage.setItem("huemix", JSON.stringify(liste));

  ausgabe.textContent = "Gespeichert:\n" + eintrag;
}

// CSV Export
function exportCSV() {
  const liste = JSON.parse(localStorage.getItem("huemix")) || [];
  if (!liste.length) return alert("Keine Daten");

  const header =
    "Datum;Name;Telefon;Stra√üe;Hausnr;PLZ;Ort;Lat;Lon;Rasen;Bio;Ausgestreut\n";

  const blob = new Blob([header + liste.join("\n")],
    { type:"text/csv;charset=utf-8;" });

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "huemix_" + new Date().toISOString().slice(0,10) + ".csv";
  a.click();
}
</script>

</body>
</html>